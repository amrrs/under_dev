---
title: "Kernel for Good - Exploring KIVA"
output: 
    html_document:
        toc: yes
        theme: cosmo
        highlight: tango
        code_folding: show
---

## What is Kiva

Kiva is an international nonprofit, founded in 2005 and based in San Francisco, with a mission to connect people through lending to alleviate poverty. We celebrate and support people looking to create a better future for themselves, their families and their communities.

## What makes Kiva unqiue

* It's a loan, not a donation
* You choose where to make an impact
* Pushing the boundaries of a loan
* Lifting one, to lift many

## Kiva highlights

```{r}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)

```

![Kiva by Numbers](https://i.imgur.com/Uo3x929.png)

## Being part of Kiva Community

These are the following roles you could play to be part of Kiva's community:

* lender, 
* borrower, 
* volunteer, 
* fellow, 
* employee, 
* Trustee, 
* Field Partner, 
* supporter


```{r}
loans <- read.csv('../input/data-science-for-good-kiva-crowdfunding/kiva_loans.csv', header = T, stringsAsFactors = F)
```

## Some boring summary statistics

The loans data has got 671205 Observations and 20 Variables with a mix of both numeric and categorical. 

```{r}
library(dplyr)
library(ggplot2)
library(ggthemes)
library(plotly)
str(loans)

```
### Agriculture leads the list of sectors in which loan is posted

```{r}
loans %>% group_by(sector) %>% count() %>% 
  ggplot() + geom_bar(aes(reorder(sector,n),n), stat = 'identity') + coord_flip() +
  theme_solarized_2() + xlab('Sectors in which the loan was posted') + ylab('Count') +
  ggtitle('Sector Distribution - Loan Activity') 

```

### How loan money is distributed among sectors

```{r}

p4 <- loans %>% ggplot() +
  geom_violin(aes(sector,loan_amount, fill = sector)) +
  scale_y_log10() + 
  coord_flip()

ggplotly(p4)
  

```


### Activity within the Sector

While overall, It's `Agriculture` that's winning, it's also important for us to know what within those overall sectors are doing good. 


```{r}

ys <- unique(loans$sector)

library(purrr)

grouped <- loans %>% group_by(sector,activity) %>% count()


ys %>% map(function(y)
  grouped %>% filter(sector %in% y) %>% ggplot() + geom_bar(aes(activity,n, fill =n),stat = 'identity') + coord_flip() + ggtitle(paste0('Distribution of ',y)) %>% 

  print())  

```


### Philippines leading in the top 10 countries in Loans data

It's quite astonishing that Philippines leads the entire country list with the second country, Kenya is less than 50% of Philippines count. The top 10 list makes it very obvious that it's all developing nations that are looking for this help from Kiva.


```{r}


loans %>% group_by(country) %>% count() %>% arrange(desc(n)) %>% head(10) %>% 
  ggplot() + geom_bar(aes(country,n), stat = 'identity') 

```

With top countries in the list, let us try to understand how their repayment pattern is:

```{r}

loans %>% group_by(country, repayment_interval) %>% count() %>% 
  ggplot() + geom_bar(aes(country,n, fill = repayment_interval), stat = 'identity') + 
   theme(axis.text.x = element_text(angle = 90, hjust = 1))

```


It looks interesting that only a few countries have weekly repayment pattern and the country is Kenya.

```{r}
library(tidyr)


loans %>% group_by(country, repayment_interval) %>% count() %>% 
  spread(repayment_interval,n) %>% filter(weekly >= 1) %>% knitr::kable() 
```

And, the country that is leading in irregularity is, Philippines - not to forget that it's also leading overall, hence this could be expected. 


```{r}

loans %>% group_by(country, repayment_interval) %>% count() %>% 
  spread(repayment_interval,n) %>% arrange(desc(irregular)) %>% head(10) %>%  knitr::kable() 
```


It's also important to note that `Cambodia` that made to the overall top 10 list hasn't made it here in the irregularity top 10 list which means, they've got a very good repayment interval.

```{r}

loans %>% group_by(country, repayment_interval) %>% count() %>% 
  spread(repayment_interval,n) %>% filter(country %in% 'Cambodia') %>%  knitr::kable() 
```

This is how the country wise split with respect to the sector is distributed. 


```{r fig.width=10, fig.height=6}

p1 <- loans %>% group_by(country, sector) %>% count() %>% 
  ggplot() + geom_bar(aes(reorder(country,n),n, fill = sector), stat = 'identity') +
  coord_flip() + theme_solarized()

ggplotly(p1)
```


### Do you think all the loan posts have funded? 

No, it's not! ~3.3K of Total posted Loans haven't been funded. 

```{r}

loans$funded <- ifelse(loans$funded_amount>0,'Funded','Not_Funded')

p2 <- loans %>% group_by(funded) %>% count() %>% 
  ggplot() + geom_bar(aes(reorder(funded,n),n), stat = 'identity')  + theme_solarized() 

ggplotly(p2)

```


### What's with the non-funded?

Shockingly, `United States` that didn't show up anywhere before seems to be topping the list of loans - not funded. 

```{r}

p3 <- loans %>% filter(funded %in% 'Not_Funded') %>% 
  group_by(country) %>% count() %>% 
    ggplot() + geom_bar(aes(reorder(country,n),n), stat = 'identity')  + theme_solarized() +
  xlab('Country') + coord_flip()
ggplotly(p3)

```

This also could be to make Kiva's missing to help the more needy ones!

But is there anything that we could identify - apart from the fact that Americans don't get to go well on Kiva.

Could it be the sector or the figure?

```{r}

p4 <- loans %>% group_by(funded) %>% ggplot() +
  geom_violin(aes(funded,loan_amount)) +
  scale_y_log10()

ggplotly(p4)
  

```


```{r}

p4 <- loans %>% group_by(funded) %>% ggplot() +
  geom_boxplot(aes(sector,loan_amount, fill = funded)) +
  scale_y_log10() + 
  coord_flip()

ggplotly(p4)
  

```


### Regions of Field Agents

Coming soon!

### What's with the use? 

Coming soon!
